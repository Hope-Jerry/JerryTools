import{V as v,F as b,c as p,E as k,g as m,D as y,R as C}from"../@codemirror/@codemirror.e164719c.js";function x(r,t=r.state){const e=new Set;for(const{from:i,to:s}of r.visibleRanges){let n=i;for(;n<=s;){const o=t.doc.lineAt(n);e.has(o)||e.add(o),n=o.to+1}}return e}function f(r){const t=r.selection.main.head;return r.doc.lineAt(t)}function d(r,t){let e=0;t:for(let i=0;i<r.length;i++)switch(r[i]){case" ":{e+=1;continue t}case"	":{e+=t-e%t;continue t}case"\r":continue t;default:break t}return e}const u=b.define({combine(r){return p(r,{highlightActiveBlock:!0,hideFirstIndent:!1,markerType:"fullScope",thickness:1})}});class A{constructor(t,e,i,s){this.lines=t,this.state=e,this.map=new Map,this.unitWidth=i,this.markerType=s;for(const n of this.lines)this.add(n);this.state.facet(u).highlightActiveBlock&&this.findAndSetActiveLines()}has(t){return this.map.has(typeof t=="number"?t:t.number)}get(t){const e=this.map.get(typeof t=="number"?t:t.number);if(!e)throw new Error("Line not found in indentation map");return e}set(t,e,i){const s=!t.text.trim().length,n={line:t,col:e,level:i,empty:s};return this.map.set(n.line.number,n),n}add(t){if(this.has(t))return this.get(t);if(!t.length||!t.text.trim().length){if(t.number===1)return this.set(t,0,0);if(t.number===this.state.doc.lines){const o=this.closestNonEmpty(t,-1);return this.set(t,0,o.level)}const s=this.closestNonEmpty(t,-1),n=this.closestNonEmpty(t,1);return s.level>=n.level&&this.markerType!=="codeOnly"?this.set(t,0,s.level):s.empty&&s.level===0&&n.level!==0?this.set(t,0,0):n.level>s.level?this.set(t,0,s.level+1):this.set(t,0,n.level)}const e=d(t.text,this.state.tabSize),i=Math.floor(e/this.unitWidth);return this.set(t,e,i)}closestNonEmpty(t,e){let i=t.number+e;for(;e===-1?i>=1:i<=this.state.doc.lines;){if(this.has(i)){const o=this.get(i);if(!o.empty)return o}const n=this.state.doc.line(i);if(n.text.trim().length){const o=d(n.text,this.state.tabSize),a=Math.floor(o/this.unitWidth);return this.set(n,o,a)}i+=e}const s=this.state.doc.line(e===-1?1:this.state.doc.lines);return this.set(s,0,0)}findAndSetActiveLines(){const t=f(this.state);if(!this.has(t))return;let e=this.get(t);if(this.has(e.line.number+1)){const n=this.get(e.line.number+1);n.level>e.level&&(e=n)}if(this.has(e.line.number-1)){const n=this.get(e.line.number-1);n.level>e.level&&(e=n)}if(e.level===0)return;e.active=e.level;let i,s;for(i=e.line.number;i>1;i--){if(!this.has(i-1))continue;const n=this.get(i-1);if(n.level<e.level)break;n.active=e.level}for(s=e.line.number;s<this.state.doc.lines;s++){if(!this.has(s+1))continue;const n=this.get(s+1);if(n.level<e.level)break;n.active=e.level}}}function E(r){const t={light:"#F0F1F2",dark:"#2B3245",activeLight:"#E4E5E6",activeDark:"#3C445C"};let e=t;return r&&(e=Object.assign(Object.assign({},t),r)),k.baseTheme({"&light":{"--indent-marker-bg-color":e.light,"--indent-marker-active-bg-color":e.activeLight},"&dark":{"--indent-marker-bg-color":e.dark,"--indent-marker-active-bg-color":e.activeDark},".cm-line":{position:"relative"},".cm-indent-markers::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:"var(--indent-markers)",pointerEvents:"none",zIndex:"-1"}})}function h(r,t,e,i,s){return`${`repeating-linear-gradient(to right, var(${r}) 0 ${t}px, transparent ${t}px ${e}ch)`} ${i*e}.5ch/calc(${e*s}ch - 1px) no-repeat`}function L(r,t,e,i){const{level:s,active:n}=r;if(e&&s===0)return[];const o=e?1:0,a=[];if(n!==void 0){const c=n-o-1;c>0&&a.push(h("--indent-marker-bg-color",i,t,o,c)),a.push(h("--indent-marker-active-bg-color",i,t,n-1,1)),n!==s&&a.push(h("--indent-marker-bg-color",i,t,n,s-n))}else a.push(h("--indent-marker-bg-color",i,t,o,s-o));return a.join(",")}class w{constructor(t){this.view=t,this.unitWidth=m(t.state),this.currentLineNumber=f(t.state).number,this.generate(t.state)}update(t){const e=m(t.state),i=e!==this.unitWidth;i&&(this.unitWidth=e);const s=f(t.state).number,n=s!==this.currentLineNumber;this.currentLineNumber=s;const o=t.state.facet(u).highlightActiveBlock&&n;(t.docChanged||t.viewportChanged||i||o)&&this.generate(t.state)}generate(t){const e=new C,i=x(this.view,t),{hideFirstIndent:s,markerType:n,thickness:o}=t.facet(u),a=new A(i,t,this.unitWidth,n);for(const c of i){const l=a.get(c.number);if(!l?.level)continue;const g=L(l,this.unitWidth,s,o);e.add(c.from,c.from,y.line({class:"cm-indent-markers",attributes:{style:`--indent-markers: ${g}`}}))}this.decorations=e.finish()}}function B(r={}){return[u.of(r),E(r.colors),v.fromClass(w,{decorations:t=>t.decorations})]}export{B as i};
